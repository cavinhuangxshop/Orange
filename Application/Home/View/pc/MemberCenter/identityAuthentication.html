<!DOCTYPE HTML>
<html>
<head>
<title>账号安全-身份认证</title>
<link rel="stylesheet" href="{:C('STATIC_URL')}/Home/css/cssReset.css" type="text/css">
<link rel="stylesheet" href="{:C('STATIC_URL')}/Home/css/public.css" type="text/css">
<link rel="stylesheet" href="{:C('STATIC_URL')}/Home/css/css.css" type="text/css">
<link rel="stylesheet" href="{:C('STATIC_URL')}/Home/css/changePhone.css" type="text/css">
<link href="{:C('STATIC_URL')}/Home/css/footer.css" rel="stylesheet">
<link rel="shortcut icon" href="{:C('STATIC_URL')}/Home/images/ee.ico" type="image/x-icon">
<script src="{:C('STATIC_URL')}/Home/js/header.js"></script>
<!--[if (gte IE 9)|!(IE)]><!-->
<script type="text/javascript" src="{:C('STATIC_URL')}/Home/static/jquery-2.0.3.min.js"></script>
<!--<![endif]-->
<!--[if lte IE 8 ]>
<script type="text/javascript" src="{:C('STATIC_URL')}/Home/static/jquery-1.10.2.min.js"></script>
<![endif]-->
<style>
.con4{
     width: 300px;
     height: 165px;
     overflow: hidden;
     margin: 20px auto;
     color: #333;
}
.con4 .btn{
     padding: 0px 10px;
     text-align: center;
     display: block;
     font-size: 14px;
     border-radius: 4px;
     height: 28px;
     line-height: 28px;
     border: 1px solid #DBDADA;
     margin-top: -10px;
         
}
.upload{
     float: left;
     position: relative;
     
}
.upload_pic{
     display: block;
     width: 100%;
     height: 28px;
     border-radius: 5px;
     position: absolute;
     left: 0px;
     top: 0px;
     opacity: 0;    
}
#cvs,#cvs2{
	border: 1px solid #DBDADA;
	width: 107px;
}
#cvs3{
	border: 1px solid #DBDADA;
	width: 87px;}
</style>
</head>
<body >
<!-- 头部_顶部start -->
<include file="MemberPublic:header_top" /> 
<!-- 头部_顶部end -->   
<!-- 头部_搜索栏start -->
<include file="MemberPublic:header_search" /> 
<!-- 头部_搜索栏end -->
<div class="bodyer">
    <div class="mar1200c clearfix">
        <include file="MemberPublic:MemberLeft" />  
        <div class="user-right marT20 box-s-c1 fRi">
            <ul class="left_top_ul">
            	<li>账户安全</li>
            	<li>>身份认证</li>
            </ul> 
            <div class="container">
            	<ul class="step_ul">
            		<li class="active">
            			<div>1</div>验证身份
            		</li>
            		<li>
            			<div>2</div>填写身份认证信息
            		</li>
            		<li>
            			<div>3</div>审核结果
            		</li>
            	</ul>
<!--第一步-->
            	<div class="change_box1">
                  <table class="phone_check">
            		<tr>
            			<td>手机号：</td>
            			<td>{$Think.session.member_data.username}</td>
            		</tr>
            		<tr>
            			<td>短信验证码：</td>
            			<td><input type="text" id="checkcode"></td>
            			<td>
            				<button class="get_code">获取短信验证码</button>            				
            			</td>
            		</tr>
            		<tr>
            			<td></td>
            			<td>
            				<div class="code_error">
            					<div>x</div>验证码错误
            				</div>
            			</td>
            			<td></td>
            		</tr>
            	  </table>
            	  <button class="nextStep1">下一步</button>
            	</div>           	
<!--第二步-->
            	<div class="change_box2">
            	<form id='form'>
                  <table class="identity">
            		<tr>
            			<td><span class="star">*</span> 真实姓名：</td>
            			<td><input type="text" id="realName" name='name'></td>
            			<td><p style="color: #999;">请填写身份证上的姓名</p></td>
            		</tr>
            		<tr>
            			<td><span class="star">*</span> 身份证号码：</td>
            			<td><input type="text" id="idcard" name='carded_code'></td>
            			<td>
            				<div class="id_error">
            					<div>x</div>身份证格式错误
            				</div>
            			</td>
            		</tr>
            		<tr>
            			<td><span class="star">*</span> 上传身份证：</td>
            			<td colspan="2"><p style="color: #999;">照片支持jpg、gif、bnp、png格式，图片最大不要超过2M。</p></td>
            		</tr>
            	  </table>
            	  <div class="idcard_img">
            	  	<div>
            	  		<p style="color: #000; font-weight: bold;">身份证正面照</p>
            	  	    <p>需要能看清姓名、身份证号码等信息。</p>
            	  	    <div class="con4">
            	  		    <canvas id="cvs" width="111" height="72"></canvas>
            	  		    <span class="btn upload">上传新照片<input type="file" class="upload_pic" id="upload" name='carded_thumb1'/></span>		                   
	                    </div>
            	  	    <div style="background: url('../../../../../Public/Home/images/identity01.png') no-repeat;"></div>           	  	    
            	  	</div>            	  	
            	  	<div>
            	  		<p style="color: #000; font-weight: bold;">身份证反面照</p>
            	  	    <p>需要看清签发机关、有限期限等信息。</p>           	  	    
            	  	    <div class="con4">
            	  		    <canvas id="cvs2" width="111" height="72"></canvas>
            	  		    <span class="btn upload">上传新照片<input type="file" class="upload_pic" id="upload2" name='carded_thumb2'/></span>		                   
	                    </div>
	                    <div style="background: url('../../../../../Public/Home/images/identity02.jpg') no-repeat;"></div>
            	  	</div>
            	  </div>
            	  <p><span class="star">*</span> 照片识别：<span style="color: #999;">照片支持jpg、gif、bnp、png格式，图片最大不要超过2M。</span> </p>
            	  <div class="idcard_img2">
            	  	<p style="color: #000; font-weight: bold;">持身份证正面头部照</p>
            	  	<div class="con4">
            	  		<canvas id="cvs3" width="89" height="89"></canvas>
            	  		<span class="btn upload">上传新照片<input type="file" class="upload_pic" id="upload3" name='carded_thumb3'/></span>		                   
	                </div>
            	  	<div style="background: url('../../../../../Public/Home/images/identity03.jpg') no-repeat;"></div>
            	  	<ul>
            	  		<li>1.照片内所持身份证必须在有效期内，没有作假痕迹。</li>
            	  		<li>2.照片内所持身份证正面，信息清晰可见，无遮挡。</li>
            	  		<li>3.照片内持证人五官清晰可见，且五官须与身份证上照片一致。</li>
            	  		<li>4.还必须与实名认证的各项身份证信息一致，包括真实姓名、身份证号等。</li>
            	  	</ul>
            	  </div>
            	  </form>
            	  <button class="nextStep2">确认,提交</button>
            	  <p style="margin-top: 30px; text-indent: 15px;">您提供的照片信息e橙优品将予以保护，不会挪作他用。</p>
            	</div>
<!--审核中-->            	
            	<div class="change_examine">
            		<p>正在审核，请您耐心等待。</p>
            	</div> 
<!--修改成功   -->         	
            	<div class="change_success">
            		<p>恭喜您，审核已通过！</p>
            		<p><a href="{:U('MemberCenter/accountSafety')}">返回</a></p>
            	</div>           	
            </div>
        </div>
    </div>
</div>
<!-- /主体 -->
<include file="Public:footer" />  

<script>

	//获取短信验证码
	$(".get_code").click(function(){
		var timer =60;
        var setTime;

         setTime=setInterval(function(){
                if(timer==0){
                	$(".get_code").css("background-color","#fff").css("color","#FF6200").css("border","1px solid #FF6200");
		            $(".get_code").text("重新获取");
                    clearInterval(setTime);
                    return;                   
                }
                timer--;
                $(".get_code").text(timer+" s 后重新获取");
                $(".get_code").css("background-color","#CCC").css("color","#666").css("border","1px solid #CCC");
            },1000);  
        
        $.post("{:U('MemberCarded/createQulificationCode')}",function(res){
        	
            
        })
        
	})
	
	function checkCode(){
        var data = {'phone_code': $("#checkcode").val()};
        $.post("{:U('MemberCarded/checkQulificationCode')}",data,function(res){
        	
            if(res.status==1){
    		  $(".change_box1").css("display","none");
    		  $(".change_box2").css("display","block");
    		  $(".step_ul li:eq(0)").removeClass("active");
    		  $(".step_ul li:eq(1)").addClass("active");
    	    }else{
    		  $(".code_error").css("display","block");
    	    }
        })        
    }
	 
	//下一步验证短信验证码
    $(".nextStep1").click(function(){
    	checkCode();    	
    })

    //身份认证
    function oldPass(){
        var data = new FormData($("#form")[0]);  // 要求使用的html对象
	    var url  = "{:U('MemberCarded/identityQualification')}";
	    $.ajax({  
	          url : url ,  
	          type: 'POST',  
	          data: data,  
	          async: true,  
	          // 下面三个参数要指定，如果不指定，会报一个JQuery的错误 
	　　　　　cache: false,  
	          contentType: false,  
	          processData: false,  
	          success: function (res) {  
	              alert(res.msg);
	              
	          },  
	          error: function (returndata) {  
	              console.log(returndata); 
	          }  
	     }); 
/*
        $.post("{:U('MemberCenter/identityQualification')}",data,function(res){
        	
        	console.log(res);
            if(res.status==1){
            	$(".step_ul li:eq(1)").removeClass("active");
    		    $(".step_ul li:eq(2)").addClass("active");
    		    $(".change_box2").css("display","none");
    		    $(".change_success").css("display","block");
            }
     	    if($("#realName").val()=="" || $("#realName").val()==" "){
                alert("请输入您的真实姓名")
            }
        })*/        
    }
    //验证身份证格式
    $("#idcard").blur(function(){   	        	     
                 checkidcard();
     })
    function checkidcard(){
      //15位身份证
	  var reg =/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$/;
	  //18位身份证
	  var reg2=/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/
	  
	  var b=document.getElementById("idcard").value;
	  var a=reg.test(b);
	  var c=reg2.test(b)
	  
	  if(a==true || c==true){
		  $(".id_error").css("display","none");
			}else{
				$(".id_error").css("display","block"); 
				}
		  }
    
    
    //下一步修改密码
     $(".nextStep2").click(function(){
     	         oldPass();     	         
     })
    
    //回车键
    $(".change_box1").keydown(function() {
             if (event.keyCode == "13"){
             	 //keyCode=13是回车键
                 $('.nextStep1').click();                 
             }
        }); 
    $(".change_box2").keydown(function() {
             if (event.keyCode == "13"){
             	 //keyCode=13是回车键
                 $('.nextStep2').click();                 
             }
       });

//上传照片
//获取上传按钮
var input1 = document.getElementById("upload"); 
var input2 = document.getElementById("upload2");
var input3 = document.getElementById("upload3");
 
if(typeof FileReader==='undefined'){ 
     //result.innerHTML = "抱歉，你的浏览器不支持 FileReader"; 
     input1.setAttribute('disabled','disabled');
     input2.setAttribute('disabled','disabled');
     input3.setAttribute('disabled','disabled');
}else{ 
     input1.addEventListener('change',readFile,false); 
     input2.addEventListener('change',readFile2,false); 
     input3.addEventListener('change',readFile3,false); 
     /*input1.addEventListener('change',function (e){
     	console.log(this.files);//上传的文件列表
     },false); */
}
function readFile(){ 
	var file = this.files[0];//获取上传文件列表中第一个文件
	if(!/image\/\w+/.test(file.type)){
	//图片文件的type值为image/png或image/jpg
		alert("文件必须为图片！");
		return false; 
	} 
	// console.log(file);
	var reader = new FileReader();//实例一个文件对象
	reader.readAsDataURL(file);//把上传的文件转换成url
	//当文件读取成功便可以调取上传的接口
	reader.onload = function(e){ 
		// console.log(this.result);//文件路径
		// console.log(e.target.result);//文件路径
		/*var data = e.target.result.split(',');
		var tp = (file.type == 'image/png')? 'png': 'jpg';
		var imgUrl = data[1];//图片的url，去掉(data:image/png;base64,)
		//需要上传到服务器的在这里可以进行ajax请求
		// console.log(imgUrl);
		// 创建一个 Image 对象 
		var image = new Image();
		// 创建一个 Image 对象 
		// image.src = imgUrl;
		image.src = e.target.result;
		image.onload = function(){
			document.body.appendChild(image);
		}*/

		var image = new Image();
		// 设置src属性 
		image.src = e.target.result;
		var max=200;
		// 绑定load事件处理器，加载完成后执行，避免同步问题
		image.onload = function(){ 
			// 获取 canvas DOM 对象 
			var canvas = document.getElementById("cvs"); 
			// 如果高度超标 宽度等比例缩放 *= 
			/*if(image.height > max) {
				image.width *= max / image.height; 
				image.height = max;
			} */
			// 获取 canvas的 2d 环境对象, 
			var ctx = canvas.getContext("2d");
			// canvas清屏 
			ctx.clearRect(0, 0, canvas.width, canvas.height);  
			// 重置canvas宽高
			/*canvas.width = image.width;
			canvas.height = image.height;
			if (canvas.width>max) {canvas.width = max;}*/
			// 将图像绘制到canvas上
			// ctx.drawImage(image, 0, 0, image.width, image.height);
			ctx.drawImage(image, 0, 0, 109, 71);
			// 注意，此时image没有加入到dom之中
		};  
	}
}; 

function readFile2(){ 
	var file = this.files[0];//获取上传文件列表中第一个文件
	if(!/image\/\w+/.test(file.type)){
	//图片文件的type值为image/png或image/jpg
		alert("文件必须为图片！");
		return false; 
	} 
	// console.log(file);
	var reader = new FileReader();//实例一个文件对象
	reader.readAsDataURL(file);//把上传的文件转换成url
	//当文件读取成功便可以调取上传的接口
	reader.onload = function(e){ 
		// console.log(this.result);//文件路径
		// console.log(e.target.result);//文件路径
		/*var data = e.target.result.split(',');
		var tp = (file.type == 'image/png')? 'png': 'jpg';
		var imgUrl = data[1];//图片的url，去掉(data:image/png;base64,)
		//需要上传到服务器的在这里可以进行ajax请求
		// console.log(imgUrl);
		// 创建一个 Image 对象 
		var image = new Image();
		// 创建一个 Image 对象 
		// image.src = imgUrl;
		image.src = e.target.result;
		image.onload = function(){
			document.body.appendChild(image);
		}*/

		var image = new Image();
		// 设置src属性 
		image.src = e.target.result;
		var max=200;
		// 绑定load事件处理器，加载完成后执行，避免同步问题
		image.onload = function(){ 
			// 获取 canvas DOM 对象 
			var canvas = document.getElementById("cvs2"); 
			// 如果高度超标 宽度等比例缩放 *= 
			/*if(image.height > max) {
				image.width *= max / image.height; 
				image.height = max;
			} */
			// 获取 canvas的 2d 环境对象, 
			var ctx = canvas.getContext("2d");
			// canvas清屏 
			ctx.clearRect(0, 0, canvas.width, canvas.height);  
			// 重置canvas宽高
			/*canvas.width = image.width;
			canvas.height = image.height;
			if (canvas.width>max) {canvas.width = max;}*/
			// 将图像绘制到canvas上
			// ctx.drawImage(image, 0, 0, image.width, image.height);
			ctx.drawImage(image, 0, 0, 109, 71);
			// 注意，此时image没有加入到dom之中
		};  
	}
}; 

function readFile3(){ 
	var file = this.files[0];//获取上传文件列表中第一个文件
	if(!/image\/\w+/.test(file.type)){
	//图片文件的type值为image/png或image/jpg
		alert("文件必须为图片！");
		return false; 
	} 
	// console.log(file);
	var reader = new FileReader();//实例一个文件对象
	reader.readAsDataURL(file);//把上传的文件转换成url
	//当文件读取成功便可以调取上传的接口
	reader.onload = function(e){ 
		// console.log(this.result);//文件路径
		// console.log(e.target.result);//文件路径
		/*var data = e.target.result.split(',');
		var tp = (file.type == 'image/png')? 'png': 'jpg';
		var imgUrl = data[1];//图片的url，去掉(data:image/png;base64,)
		//需要上传到服务器的在这里可以进行ajax请求
		// console.log(imgUrl);
		// 创建一个 Image 对象 
		var image = new Image();
		// 创建一个 Image 对象 
		// image.src = imgUrl;
		image.src = e.target.result;
		image.onload = function(){
			document.body.appendChild(image);
		}*/

		var image = new Image();
		// 设置src属性 
		image.src = e.target.result;
		var max=200;
		// 绑定load事件处理器，加载完成后执行，避免同步问题
		image.onload = function(){ 
			// 获取 canvas DOM 对象 
			var canvas = document.getElementById("cvs3"); 
			// 如果高度超标 宽度等比例缩放 *= 
			/*if(image.height > max) {
				image.width *= max / image.height; 
				image.height = max;
			} */
			// 获取 canvas的 2d 环境对象, 
			var ctx = canvas.getContext("2d");
			// canvas清屏 
			ctx.clearRect(0, 0, canvas.width, canvas.height);  
			// 重置canvas宽高
			/*canvas.width = image.width;
			canvas.height = image.height;
			if (canvas.width>max) {canvas.width = max;}*/
			// 将图像绘制到canvas上
			// ctx.drawImage(image, 0, 0, image.width, image.height);
			ctx.drawImage(image, 0, 0, 89, 89);
			// 注意，此时image没有加入到dom之中
		};  
	}
}; 
     
     
    
  
  
  

</script>
</body>
</html>