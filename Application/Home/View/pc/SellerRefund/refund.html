<!DOCTYPE HTML>
<html>
<head>
<title>退款管理</title>
<link rel="stylesheet" href="{:C('STATIC_URL')}/Home/css/cssReset.css" type="text/css">
<link rel="stylesheet" href="{:C('STATIC_URL')}/Home/css/public.css" type="text/css">
<link rel="stylesheet" href="{:C('STATIC_URL')}/Home/css/all-use.css" type="text/css">
<link rel="stylesheet" href="{:C('STATIC_URL')}/Home/css/side-nav.css" type="text/css">
<link href="{:C('STATIC_URL')}/Home/css/footer.css" rel="stylesheet">
<link rel="stylesheet" href="{:C('STATIC_URL')}/Home/css/sell-management.css">
<link rel="shortcut icon" href="{:C('STATIC_URL')}/Home/images/ee.ico" type="image/x-icon">
<script src="{:C('STATIC_URL')}/Home/js/header.js"></script>
<!--[if (gte IE 9)|!(IE)]><!-->
<script type="text/javascript" src="{:C('STATIC_URL')}/Home/static/jquery-2.0.3.min.js"></script>
<!--<![endif]-->
<!--[if lte IE 8 ]>
<script type="text/javascript" src="{:C('STATIC_URL')}/Home/static/jquery-1.10.2.min.js"></script>
<![endif]-->
<script type="text/javascript" src="{:C('STATIC_URL')}/js/ajaxPage.js"></script>
<style>
.refund{ width: 970px; border: 1px solid #E4E4E4; float: left; margin: 30px 0px 0px 6px;}
.refund_top{ width: 100%; background-color: #F2F1F1; padding: 10px 40px; box-sizing: border-box;}
.refund_box{ padding: 10px 30px;margin-bottom: 20px;}
.refund_box>button{ color: white; padding: 3px 16px; background-color: #37A4A2; border-radius: 5px;font-family: "微软雅黑"; margin: 20px 0px 10px 0px;}
.refund_box>table td{ text-align: left; height: 45px; width: 330px;}
.refundInput{ height: 20px; width: 160px; padding: 2px 4px; }
.refundTime{ width: 85px; padding: 2px 6px; height: 20px}
.refundReason{width: 220px; height: 26px; font-size: 12px; border-color: #E6E6E6; background-color: #EEEEEE; padding: 0px 5px; font-family: "微软雅黑"; cursor: pointer;}
.op{ background-color: white; border-color:#E6E6E6;}
.search_box1{ width: 100%; padding: 20px 0px;}
.search_box2{ width: 100%; min-height: 186px;}
.search_box2>p{ text-align: center; font-size: 14px; color: #333; margin-top: 50px;}
.refund-list{width: 100%;}
.refund-list thead tr td{background-color: #E4E4E4;line-height: 34px;border-color: #E4E4E4;}
.refund-list tbody tr td{border-color: #E4E4E4;padding: 4px;}
.refund-list tbody tr td a{color: #547AC5;}
.refund-list tr td:first-of-type{width: 15%;}.refund-list tr td:nth-of-type(2){width: 15%;}.refund-list tr td:nth-of-type(3){width: 10%;}
.refund-list tr td:nth-of-type(4){width: 10%;}.refund-list tr td:nth-of-type(5){width: 10%;}.refund-list tr td:nth-of-type(6){width: 10%;}
.refund-list tr td:nth-of-type(7){width: 10%;}.refund-list tr td:nth-of-type(8){width: 8%;}.refund-list tr td:nth-of-type(9){width: 8%;}
</style>
</head>
<body >
<!-- 头部_顶部start -->
<include file="MemberPublic:header_top" /> 
<!-- 头部_顶部end --> 
<!-- 头部_搜索栏start -->
<include file="MemberPublic:header_search" /> 
<!-- 头部_搜索栏end -->
<div class="bodyer">
    <div class="mar1200c clearfix">
        <include file="Public:sellerLeft" />         
            <div class="sell-management clearfix" style='width:auto;'>
                <div class="refund">
                	<div class="refund_top">退款管理</div>
                	<div class="refund_box">
                		<table class="noBorder">
                			<tr>
                				<td>订单编号： <input type="text" class="refundInput" /></td>
                				<td>退款申请时间： <input type="text" class="refundTime" value="" /> 到 <input type="text"  class="refundTime" value=""/></td>
                			</tr>
                			<tr>
                				<td>退款编号： <input type="text" class="refundInput" /></td>
                				<td>
                					退款状态： 
            		                <select class="refundReason">
		        		               	<option class="op">全部</option>
		        		                <option class="op">退款申请等待买家确认</option>	
		        		                <option class="op">卖家不同意，等待买家修改</option>	
		        		                <option class="op">退款申请达成，等待买家发货</option>	
		        		                <option class="op">卖家已发货，等待买家确认收货</option>	
		        		                <option class="op">退款关闭</option>	
		        		                <option class="op">退款成功</option>	
            		                </select>
                				</td>
                			</tr>
                		</table>    
                		<button>搜索</button>
                		<!--<div class="search_box1">
                			没有符合的退款订单，请尝试其他搜索条件。
                		</div>-->
                	</div>
                	<div class="search_box2">
                		<!--<p>没有符合的退款订单，请尝试其他搜索条件。</p>-->
                		<table class="refund-list">
                			<thead>
                				<tr>
                					<td>退款编号</td>
                					<td>订单编号</td>
                					<td>买家</td>
                					<td>交易金额</td>
                					<td>退款金额</td>
                					<td>申请时间</td>
                					<td>超时时间</td>
                					<td>退款状态</td>
                					<td>操作</td>
                				</tr>
                			</thead>
                			<tbody>
                			</tbody>
                		</table>
                	</div>
                	<!--分页-->
                	<div class="page">
                		<ul></ul>
                	</div>
                </div>
            </div>                   
    </div>
</div>
<!-- 底部 -->
<include file="Public:footer" />
<!-- 底部 -->    
</body>
<script>
//判断左边导航
function checkNav(){
	$(".side-nav>ul:eq(4)>li:eq(2) a").css("color","#ff6600")
}
checkNav();

/*分页*/
(function(e){
var Page = function(config){
    this.config(config);//配置    
    this.ajax();//第一次ajax请求
}

Page.prototype = {
    config:function(config){   
    	//请求地址
        this.url        = config.url;
        // 分页栏每页显示的页数
        this.rollPage   = /^[1-9]+[0-9]*]*$/.test(config.rollPage) ? config.rollPage : 3;
        // 附加请求参数
        this.paramer    = config.paramer ? config.paramer : '';
        //总记录数 
        this.totalRows;
        //第多少条开始取  
        this.firstRow;
        //设置每页显示条数 默认20条
        this.listRows   = /^[1-9]+[0-9]*]*$/.test(config.listRows) ? config.listRows : 20; 
        //当前页数默认为1
        this.nowPage    = /^[1-9]+[0-9]*]*$/.test(config.nowPage) ? config.nowPage : 1;
        //每页显示的多少条数据 
        this.callback   = config.callback||'';
        //分页数据
        this.page       = {};
    },
    /***初始运行***/
    init:function(){
    	//获得分页内容
        this.get_page();
        //回调函数
        this.callback(this.data , this.page); 
    },
    /***ajax请求***/
    ajax:function(){
        var _this     = this;
        this.firstRow = this.listRows * (this.nowPage - 1);      
        var d = {firstRow : this.firstRow , listRows : this.listRows};
        for(i in this.parameter){
            if(typeof(this.parameter[i]) != 'undefined'){
         	    d[i] = this.parameter[i];
            }       
        }
        $.post(this.url,d,function(res){
	        if(res){       
			      //res= eval('(' +res + ')');
			    _this.data      = res['data'];
			    _this.totalRows = res['total'];
			    _this.init();
	        }
        })   
    }, 
     /***分页***/
    get_page:function(){
    	var __PAGE = {
    		prev      : false,
    		first     : false,
    		page      : [],
    		next      : false,
    		end       : false,
    		now_page  : ''
    	};
        /* 计算分页信息 */
        this.totalPages = Math.ceil(this.totalRows/this.listRows); //总页数
        //当前页面大于总页面
        if(!this.totalPages && this.nowPage > this.totalPages){
           this.nowPage = this.totalPages;//当前页面设置为总页面
        } 
        /* 计算分页临时变量 */
        now_cool_page      = this.rollPage / 2;
        now_cool_page_ceil = Math.ceil(now_cool_page);
        //上一页
        up_row  = this.nowPage - 1;  
        __PAGE.prev = up_row > 0 ? up_row : false;
        //下一页
        down_row  = this.nowPage+1;  
        __PAGE.next = (down_row <= this.totalPages) > 0 ? down_row : false;    
        //数字连接
        for(i = 1; i <= this.rollPage;i++){
            /*计算出页数*/
            if((this.nowPage - now_cool_page) <= 0 ){
                page = i;
            }else
            if((this.nowPage + now_cool_page - 1) >= this.totalPages){
                page = this.totalPages - this.rollPage + i;
            }else{
                page = this.nowPage - now_cool_page_ceil + i;
            }  
            //页数大于0并且页数不等于当前页面         
            if(page > 0 && page != this.nowPage){
                //当前页数小于或者等于总页数才让其显示
                if(page <= this.totalPages){
                 	__PAGE.page.push(page);                           
                }else{
                    break;
                }
            }else         
            if(this.nowPage==page){
             	__PAGE.page.push(page);
             	__PAGE.now_page = page;
            } 
        }
        __PAGE.totalPages = this.totalPages;
        __PAGE.totalRows  = this.totalRows; 
        this.page = __PAGE;         
    }, 
}

e.ajaxPage = function(config){
    return new Page(config);
}
})(window);


(function(e){
$(".page ul").on('click' , '.page_a' , function(){
    var p = $(this).attr('data-p');
    PageObj.nowPage = parseInt(p);
    PageObj.ajax();    
})     

$(".page ul").on('click' , '.jump' , function(){
    var p = $("input[name='jump_page']").val();
    PageObj.nowPage = parseInt(p);
    PageObj.ajax();    
}) 

$(".page ul").on('change' , '.set_listRows' , function(){
    var listRows = $(this).val();
    PageObj.nowPage  = 1;
    PageObj.listRows = listRows;
    PageObj.ajax();    
}) 

$("#main table").on('click' , '.change_status' , function(){
    var status = parseInt($(this).attr('data-status'));
    var id     = $(this).parents('tr').attr('data-id');
    var _this  = this;
    status = status == 1 ? 0 : 1;
    $.post(status_url , {id : id , status : status} , function(res){
        if(res.status == '1'){
            $(_this).parents('tr').remove();
        }
    })    
}) 

$("#main table").on('click' , '.delete' , function(){
    var id     = $(this).parents('tr').attr('data-id');
    var _this  = this;
    $.post(delete_url , {id : id} , function(res){
        if(res.status == '1'){
            $(_this).attr('data-status' , status);                
        }
    })    
}) 

/*
 * 时间戳转日期
 * */	
function formatDate(time){   
    time = parseInt(time); 
	if(!/^[0-9]{10}$/.test(time)){
        return '';
	}		
	time = time * 1000;
	var now    = new Date(time);  
    var year   = now.getFullYear();  
    var month  = now.getMonth()+1;     
    var date   = now.getDate();     
    var hour   = now.getHours();     
    var minute = now.getMinutes();
    var second = now.getSeconds(); 
    month  = month < 10 ? '0' + month : month;
    date   = date < 10 ? '0' + date : date;
    hour   = hour < 10 ? hour + '0' : hour;
    minute = minute < 10 ? '0' + minute : minute;
    second = second < 10 ? '0' + second : second;
    return   year + "-" + month + "-" + date + "   " + hour + ":" + minute + ":" + second;     
} 

var html = {
	createHtml : function(data){
		var html = '';
	    for(var k in data){
	        html = html 
	             + '<tr data-id="' + data[k].id + '">'
	             + '    <td class="td">'
	             + '        <div class="select_checkbox">'
	             +             data[k].refund_sn 
	             + '        </div>'
	             + '    </td>'
	             + '    <td class="table_td">' + data[k].order_sn + '</td>'
	             + '    <td class="table_td">' + data[k].buy_name + '</td>'
	             + '    <td class="table_td">' + data[k].order_price + '</td>'
	             + '    <td class="table_td">' + data[k].case + '</td>'	             
	             + '    <td class="table_td">' + formatDate(data[k].create_time) + '</td>'
	             + '    <td class="table_td">' 
	             +          formatDate(2 * 3600 * 24 + parseInt(data[k].create_time)) 
	             + '</td>'
	             + '    <td class="table_td">'
	             +          __STATUS[data[k].status]         
	             + '    </td>'
	             + '    <td class="table_handle">'
	             + '        <a href="' + refund_detail_url + '&id=' + data[k].id + '" target="_blank" class="table_handle_a"> 审核</a>'
	             + '    </td>'
	             + '</tr>';
	    }
        return html;
	},	
	createPage : function(data){
	    var page = listRows_option;
	    page += data.first !== false ? ('<a class="first" href="javascript:;">首页</a>') :
	        ('<a class="first">首页</a>');
	    page += data.prev !== false ? ('<a class="prev" href="javascript:;">上一页</a>') :
	        ('<a class="first">上一页</a>');     
	    for(var k in data.page){
	    	page += data.page[k] == data.now_page ? 
	    	    ('<a class="page_a now" data-p=' + data.page[k] + '>' + data.page[k] +'</a>') :
	    	    ('<a class="page_a" href="javascript:;" data-p=' + data.page[k] + '>' + data.page[k] +'</a>');   	
	    } 
	    page += data.next !== false ? ('<a class="first" href="javascript:;">下一页</a>') :
	        ('<a class="first">下一页</a>');
	    page += data.end !== false ? ('<a class="first" href="javascript:;">末页</a>') :
	        ('<a class="first">末页</a>');             
	    page += '<p class="total">共' + data.totalPages + '页' + data.totalRows + '条数据</p>'; 
	    page += '<input name="jump_page" value="1">';   
	    page += '<a href="javascript:;" class="jump">GO</a>';
	    return data;         
	},   
	createListRowsOption : function(data){
		var str = '<select class="set_listRows">';
		data.map(function(v){
	        str +='<option value="' + v + '">' + v +'</option>';
		});
		str +='</select>';
		return str;    	
	}
};
var __STATUS = {
	'0'  : '申请中',
	'-1' : '不同意',
	'-2' : '已撤销',
	'1'  : '同意',
	'2'  : '已完成'
},
refund_detail_url = 'http://www.orangesha.com?m=Home&c=SellerRefund&a=refundDetail',
listRows_option = html.createListRowsOption([10 , 20 , 40]);
var config   = {
    listRows  : 10, 
    rollPage  : 3,
    url       : "http://www.orangesha.com/index.php/Home/SellerRefund/getRefundList",
    callback:function(data,page){          
        $(".refund-list tbody").html(html.createHtml(data));
        $(".page ul").html(html.createPage(page));        
	}
};
var PageObj = ajaxPage(config);
})();
</script>
</html>