<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>新建网页</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript" src="__PUBLIC__/js/jquery-1.8.3.min.js"></script>
<meta name="description" content="" />
<style>
*{padding:0; margin:0;font-size:14px;}
   ul,li{padding:0; margin:0;}
   ul,li{list-style:none;}
   a{text-decoration:none;}
   a:hover{text-decoration:none;border: 0} 
html{font-size:62.5%}
*{font-size:16px;font-family:Arial,Microsoft YaHei,\\9ED1\4F53,\\5B8B\4F53,sans-serif}
*,li,ul{padding:0;margin:0}
li,ul{list-style:none}
a,a:hover{text-decoration:none}
a:hover{border:0}
button,input,select,textarea{outline:none}
textarea{resize:none}

#container{width:98%;margin-left:1%}
#container #main{width:100%;border:1px solid #d7d7d7;margin-top:5px;height:auto;float:left;padding-bottom:10px}

#Crumbs{width:100%;height:40px;border:1px solid #d7d7d7;line-height:40px;margin-top:5px;float:left}
#Crumbs a{padding-left:10px}

.block_edit table td .radio,.check{width:20px;height:20px;float:left;margin-left:15px;}
.radio_m{margin-left:0px;}
.radio_text{height:20px;float:left;line-height:20px}

.block_edit{width:100%;height:auto;float:left}
.block_edit table{width:100%;margin:10px auto}
.block_edit table td{padding:5px}
.block_edit table td.td_label{text-align:right;vertical-align:top;font-weight:700;width:20%;font-size:14px;padding:4px 8px}
.block_edit table td .type_radio{width:auto;height:24px;float:left;margin-left:8px}
.block_edit table td input[type='text']{width:400px;height:20px;border-radius:3px;border-bottom:1px solid #e3e9ef;border-top:1px solid #abadb3;border-left:1px solid #e2e3ea;border-right:1px solid #dbdfe6}
.block_edit table td .p_text{width:auto;height:25px;float:left;line-height:24px;margin-left:8px;font-size:13px}

.img{width:100px;height:auto;float:left;}
.img .load{display:none;position:relative;width:100px;height:16px;border:1px solid pink;float:left;margin-top:4px;}
.img .load p{width:0px;height:16px;border:1px solid pink;float:left;color:black;text-align:center;line-height:16px;background:pink;}
.img .load span{position:absolute;display:block;width:100px;height:16px;left:0;top:0;text-align:center;}
.img img{max-width:100%;max-height:100px;float:left}
/****上传按钮样式构造****/
.btn_addimg{display:block;width:100px;margin-top:5px;color:white;position:relative;height:28px;line-height:28px;text-align:center;float:left;background:#C43926;border-radius:4px;}
.btn_addimg input{width:100px;position:absolute;left:0;top:0;filter:alpha(opacity=50);-moz-opacity:0;-khtml-opacity:0;opacity:0;} 
  

textarea{outline:none;resize:none;}
.img{width:100px;height:auto;float:left;}
.img img{max-width:100%;max-height:100px;float:left}

.btn{display:block;width:100px;margin-top:10px;color:white;position:relative;height:28px;line-height:28px;text-align:center;float:left;background:#C43926;border-radius:4px;}
.btn_submit{width:100px;}
.btn_select_class{width:100px;margin-top:0px;}

.checkbox{width:16px;height:16px;float:left;}
.checkbox_text{width:130px;height:18px;float:left;
    white-space:nowrap; 
    text-overflow:ellipsis; 
    -o-text-overflow:ellipsis; 
    overflow: hidden; 
}

.fixed_wraper{ 
    width:100%;
    height:100%;
    position:fixed;
    background:white;
    z-index:9999;
    display:none;
}

.fixed_wraper .tree{
    width:auto;
    height:auto;
    margin-top:20px;
    margin-left:20px;
    float:left;
}

.fixed_wraper .attr{
    width:200px;
    height:700px;
    margin-top:20px;
    float:left;
    margin-left:15px;
    border:1px solid pink;
}

.fixed_wraper .attr li{
    width:180px;
    margin-left:10px;
    margin-top:5px;
    height:auto;
    float:left;
}

.fixed_wraper .attr li a{
    margin-left:8px;
}

.fixed_wraper .handle{
    width:100px;
    height:auto;
    float:left;
    margin-top:20px;
    margin-left:15px;
}

.fixed_wraper .tree .tree_list{
    width:200px;
    height:700px;
    float:left;
    border:1px solid pink;
    padding:5px 5px 5px 10px;
    margin-left:5px;
    overflow-y:scroll;
}
.fixed_wraper .tree .tree_list li{
    margin-top:5px;
}
.fixed_wraper .tree .tree_list li a.color{
    color:pink;
}
</style>
</head>
<body>  
<div class="fixed_wraper"></div>        
<div id="container">
    <div id="Crumbs">
        <a>后台管理中心</a><span>&nbsp;&nbsp;-</span><a>商品分类添加</a>
    </div>
    <div id="main">
        <div class="block_edit">		               		               
	        <form id='form'>
                <input type='hidden' value='0' name='pid'/>
                <table cellspacing="10">
                    <tr>
                        <td class="td_label">上级分类:</td>
                        <td>
                            <p class="pid_text"></p>
                            <a href="javascript:;" class="btn btn_select_class">选择</a>
                        </td>
                    </tr>
	                <tr>
	                    <td class="td_label">分类名:</td>
	                    <td>
	                       <input type="text" name="cat_name"></input>
	                    </td>
	                </tr>                             	                                    
                    <tr>
                        <td class="td_label">商品品牌筛选:</td>
                        <td>
                            <ul class='brand' style='width:600px'>
                              <volist name='brands' id='v'>
                              <li style="width:150px;float:left;margin-top:5px">
                              <label class='checkbox_text'>{$v['brand_name']}:</label>
                              <input type='checkbox' name='brand_id[]' value="{$v['id']}" class='checkbox' />
                              </volist>
                              </li>
                            </ul>
                        </td>
                    </tr> 
                    <tr>
                        <td class="td_label">路由配置:</td>
                        <td>
                            <input type="text" name="router"></input>                           
                        </td>
                    </tr>                                           
                    <tr>
                        <td class="td_label">排序:</td>
                        <td><input type="text" name="sort" value="{$sort}"></input></td>
                    </tr>
                    <tr>
                        <td class="td_label">是否显示:</td>
                        <td>
                           <input type="radio" name="status" value="1" checked='checked' class='isshow'></input><p style="height:20px;float:left;line-height:20px">是</p>
                           <input type="radio" name="status" style="margin-left:15px" class='isshow' value="0"></input><p style="height:20px;float:left;line-height:20px;">否</p>
                        </td>
                    </tr>
                    <tr>
                        <td class="td_label">分类描述:</td>
                        <td><textarea style="width:500px;height:200px" name="cat_remark"></textarea></td>
                    </tr>
                    <tr>
                        <td class="td_label">首页左侧分类图标:</td>
                        <td style="padding-top:0">
                            <div class="img">
                            <img />
                            <a class="btn_addimg">点击添加<input type="file" name="index_thumb" onchange='show(this);'></input></a>                                          
                            </div> 
                        </td>
                    </tr>                      
                    <tr>
                        <td class="td_label">上传图片:</td>
                        <td style="padding-top:0">
                        	<div class="img">
                        	<img />
                            <a class="btn_addimg">点击添加<input type="file" name="cat_thumb" onchange='show(this);'></input></a>                                             
                            </div> 
                        </td>
                    </tr>
                    <tr>
                        <td class="td_label">首页品牌商城图片:</td>
                        <td style="padding-top:0">
                            <div class="img">
                            <img />
                            <a class="btn_addimg">点击添加<input type="file" name="cat_thumb_1" onchange='show(this);'></input></a>                                             
                            </div> 
                        </td>
                    </tr>                     
                    <tr>
	                    <td></td>
	                    <td>
	                        <a class='btn btn_submit' href='javascript:;'>确认添加</a>
	                    </td>
                    </tr>	
                </table>	
            </form>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="__PUBLIC__/js/Admin/Tree/categoryTree.js"></script>
<script type="text/javascript">  
/*
 * 点击获取商品类型属性
 * */    
$(".select_goods_type").change(function(){
	var _this   = this;
	var type_id = $(".select_goods_type option:selected").val();
	$.post("{:U('Goodstype/getFilterAttr')}",{"type_id":type_id},function(res){
	      var html = getExtendAttrHtml(res);
	      $(".select ul").html(html);
    }); 
})

function getExtendAttrHtml(data){
	var html = [];
    for(var k in data){
    	html.push("<li class='goods_attr'>" + data[k].attr_name);
    	html.push("    <input type='hidden' name='filter_extendattr[]' value='"+ data[k].attr_id + "'>");                               
        html.push("</li>");                                                         
    }
    return html;
}

$(".btn_submit").click(function(){
    request();
})

/*
 * 提交数据
 **/
function request(){  
    var data = new FormData($("#form")[0]);  // 要求使用的html对象
    var url  = "{:U('categoryAdd')}";
    var url_ = "{:U('categoryList')}"
    $.ajax({  
        url : url ,  
        type: 'POST',  
        data: data,  
        async: true,  
        // 下面三个参数要指定，如果不指定，会报一个JQuery的错误 
　　　  cache: false,  
        contentType: false,  
        processData: false,  
        success: function (res) {  
          	alert(res.msg);
            if(res.status){
                window.location.href = url_;
            }  
        },  
        error: function (returndata) {  
            console.log(returndata); 
        }  
    });  
}

//上传图片预览
function show(obj){
    var file = obj.files[0];   
    var reader = new FileReader();  
    //将文件以Data URL形式读入页面  
    reader.readAsDataURL(file);  
    reader.onload = function(e){ 
   	    //显示文件  
   	    $(".img img").attr("src",this.result);
    }
} 

var url = "{:U('Mall_category/categoryList')}";
class_tree.init({
	url : url,
    setConfirmFun : function(cat_id , cat_name){
		$("input[name='pid']").val(cat_id);
	    $(".pid_text").text(cat_name);
	    class_tree.hideTree(); 
    }	
});

$(".btn_select_class").click(function(){	
    class_tree.showTree(); 
})
</script>
</html>